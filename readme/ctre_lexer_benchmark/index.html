<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<title>ctre_lexer_benchmark</title><link rel="stylesheet" href="/normalize.css" data-svelte="svelte-tloy57"><link rel="stylesheet" href="/skeleton.css" data-svelte="svelte-tloy57"><link rel="stylesheet" href="/atom-dark.css" data-svelte="svelte-tloy57"><script src="/chart.min.js" data-svelte="svelte-tloy57"></script><script src="/chartjs_boxplot/index.umd.js" data-svelte="svelte-tloy57"></script><script src="/chartjs_error_bars/index.umd.js" data-svelte="svelte-tloy57"></script>

		

		<link rel="modulepreload" href="/_app/start-47896492.js">
		<link rel="modulepreload" href="/_app/chunks/vendor-774d9537.js">
		<link rel="modulepreload" href="/_app/chunks/paths-28a87002.js">
		<link rel="modulepreload" href="/_app/pages/__layout.svelte-fd97c867.js">
		<link rel="modulepreload" href="/_app/pages/readme/[slug].svelte-ca7dc303.js">
		<link rel="stylesheet" href="/_app/assets/start-61d1577b.css">
		<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-5e87a37c.css">
		<link rel="stylesheet" href="/_app/assets/pages/readme/[slug].svelte-e0f661c8.css">

		<script type="module">
			import { start } from "/_app/start-47896492.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":""},
				session: {},
				host: location.host,
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/_app/pages/__layout.svelte-fd97c867.js"),
						import("/_app/pages/readme/[slug].svelte-ca7dc303.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "/readme/ctre_lexer_benchmark",
						query: new URLSearchParams(""),
						params: {"slug":"ctre_lexer_benchmark"}
					}
				}
			});
		</script>
	</head>
	<body>
		<div id="svelte">




<header><div class="container"><nav class="navbar"><a sveltekit:prefetch class="navbar-item navbar-link svelte-fav7xq" href="/">Home</a>
			<a sveltekit:prefetch class="navbar-item navbar-link svelte-fav7xq" href="/about">About</a>
			<a sveltekit:prefetch class="navbar-item navbar-link svelte-fav7xq" href="/activity">Activity</a>
			<a sveltekit:prefetch class="navbar-item navbar-link svelte-fav7xq" href="/gists">Gists</a>
			<a sveltekit:prefetch class="navbar-item navbar-link svelte-fav7xq" href="/cool-repos">Cool Repos</a>
			<a sveltekit:prefetch class="navbar-item navbar-link svelte-fav7xq" href="/blog">Blog</a>
			</nav></div></header>

<main class="container">

<h1 class="title svelte-1mgzh8t">ctre_lexer_benchmark</h1>
<p class="info"><a href="https://github.com/andersama">Andersama</a> 2020-11-19T06:25:02Z / last updated: 2020-12-22T20:36:27Z</p>
<!-- HTML_TAG_START --><h1>ctre_lexer_benchmark</h1>
<p>A quick test of different lexing approaches. Unfortuantely while ctre is fantastic for generating native code that you'd have otherwise written by hand, it can be outdone with a dfa approach.</p>
<p>Some not so great testing results...where my naive attempts blow ctre out of the water.</p>
<p>Note: not exactly a complete test suite, here I'm comparing approaches to lex whitespace and non-whitespace characters. The dfa is extremely small.</p>
<pre><code class="hljs language-apache">| <span class="hljs-attribute">relative</span> |             ns/byte |              byte/s |    err% |     total | benchmark
|---------:|--------------------:|--------------------:|--------:|----------:|:----------
|   <span class="hljs-attribute">100</span>.<span class="hljs-number">0</span>% |                <span class="hljs-number">2</span>.<span class="hljs-number">12</span> |      <span class="hljs-number">472</span>,<span class="hljs-number">049</span>,<span class="hljs-number">817</span>.<span class="hljs-number">08</span> |    <span class="hljs-number">0</span>.<span class="hljs-number">7</span>% |      <span class="hljs-number">0</span>.<span class="hljs-number">32</span> | `hand_coded table`
|   <span class="hljs-attribute">214</span>.<span class="hljs-number">2</span>% |                <span class="hljs-number">0</span>.<span class="hljs-number">99</span> |    <span class="hljs-number">1</span>,<span class="hljs-number">011</span>,<span class="hljs-number">189</span>,<span class="hljs-number">413</span>.<span class="hljs-number">06</span> |    <span class="hljs-number">1</span>.<span class="hljs-number">6</span>% |      <span class="hljs-number">0</span>.<span class="hljs-number">35</span> | `hand_coded table sse`
|    <span class="hljs-attribute">97</span>.<span class="hljs-number">1</span>% |                <span class="hljs-number">2</span>.<span class="hljs-number">18</span> |      <span class="hljs-number">458</span>,<span class="hljs-number">505</span>,<span class="hljs-number">050</span>.<span class="hljs-number">23</span> |    <span class="hljs-number">2</span>.<span class="hljs-number">7</span>% |      <span class="hljs-number">0</span>.<span class="hljs-number">32</span> | `hand_coded switch inside if`
|    <span class="hljs-attribute">94</span>.<span class="hljs-number">9</span>% |                <span class="hljs-number">2</span>.<span class="hljs-number">23</span> |      <span class="hljs-number">447</span>,<span class="hljs-number">839</span>,<span class="hljs-number">585</span>.<span class="hljs-number">40</span> |    <span class="hljs-number">3</span>.<span class="hljs-number">9</span>% |      <span class="hljs-number">0</span>.<span class="hljs-number">33</span> | `hand_coded switch only in loop`
|    <span class="hljs-attribute">60</span>.<span class="hljs-number">6</span>% |                <span class="hljs-number">3</span>.<span class="hljs-number">50</span> |      <span class="hljs-number">285</span>,<span class="hljs-number">960</span>,<span class="hljs-number">135</span>.<span class="hljs-number">45</span> |    <span class="hljs-number">1</span>.<span class="hljs-number">4</span>% |      <span class="hljs-number">0</span>.<span class="hljs-number">35</span> | `hand_coded break to switch`
|    <span class="hljs-attribute">11</span>.<span class="hljs-number">8</span>% |               <span class="hljs-number">17</span>.<span class="hljs-number">97</span> |       <span class="hljs-number">55</span>,<span class="hljs-number">642</span>,<span class="hljs-number">484</span>.<span class="hljs-number">11</span> |    <span class="hljs-number">0</span>.<span class="hljs-number">7</span>% |      <span class="hljs-number">0</span>.<span class="hljs-number">66</span> | `ctre::starts_with`
|     <span class="hljs-attribute">8</span>.<span class="hljs-number">1</span>% |               <span class="hljs-number">26</span>.<span class="hljs-number">04</span> |       <span class="hljs-number">38</span>,<span class="hljs-number">396</span>,<span class="hljs-number">531</span>.<span class="hljs-number">90</span> |    <span class="hljs-number">0</span>.<span class="hljs-number">1</span>% |      <span class="hljs-number">0</span>.<span class="hljs-number">92</span> | `ctre::starts_with overlap_strs`
</code></pre>
<p>I absolutely hate and detest having to write tables by hand. So I'm very motivated to improve on ctre. Since regexs can be represented as dfa's I don't see any particular reason why there shouldn't be an equivalent ctdfa library. In fact in having played around with the internals of the ctre library a few times it seems extremely tempting to rip the existing compile time parser for the purpose of building dfas.</p>
<p>In testing I've already found a significant improvement in searching for a string based pattern by transforming some strings info a prefix dfa matcher. A lot of the current results are mostly an unfortunate consequence of branch misprediction, otherwise the native code representing the regex should be a clear win. Another option would be to perhaps make a "helper" ctre function to generate something more akin to an optimal lexer, much like "starts_with". Don't want to bother Hana though.</p>
<p>I've picked up a few new tricks from <a href="https://branchfree.org/">https://branchfree.org/</a>, quite frankly my original lexers were quite a mess of a combination of the two approaches, and I'd have been happy to have results akin to <code>ctre:::starts_with</code> here. However that lexer does significantly more work for an even more complicated regular expression, it keeps track of rows and columns, de-escapes strings and adds them to a hash table database and peforms both string to integer and string to floating point operations. It's difficult to gauge how good my lexer is without peformance benchmarks of other lexers built to tackle the same problem space. The ones I've found like for the RE2 library and even for tinyC lead me to think I'm close, but at the same time given the results touted by simdjson, simdcsv and hyperscan lead me to think otherwise.</p>
<p>Another consideration is I've not dealt with or touched anything to do w/ utf8. There's an obvious cost to the dfa table size if the dfa is meant to handle utf8 sequences. It's not entirely obvious to me whether processing input in utf8 form is worth it, the variable size would seem to mean that there'd need to be two loops, which would add another branch predicition issue into the mix.</p>
<p>Ideally I'd have a library that:</p>
<ul>
<li>Can represent a language as a series of regexs at compile time</li>
<li>Can generate some near optimal code for a lexer</li>
</ul>
<p>I can live with post processing tokens, I'd much rather have a blazing fast lexer / parser in my tool belt.</p>
<p>Note to self: Just spotted dfa branch in the ctre library* will be taking a look at that.</p><!-- HTML_TAG_END --></main>

<footer class="svelte-fav7xq"><p>Â© Alex Anderson</p></footer>




			<script type="application/json" data-type="svelte-data" data-url="/readme/ctre_lexer_benchmark.json">{"status":200,"statusText":"","headers":{"content-type":"text/plain;charset=UTF-8"},"body":"{\"id\":314155697,\"node_id\":\"MDEwOlJlcG9zaXRvcnkzMTQxNTU2OTc=\",\"name\":\"ctre_lexer_benchmark\",\"full_name\":\"Andersama\u002Fctre_lexer_benchmark\",\"private\":false,\"owner\":{\"login\":\"Andersama\",\"id\":25020235,\"node_id\":\"MDQ6VXNlcjI1MDIwMjM1\",\"avatar_url\":\"https:\u002F\u002Favatars.githubusercontent.com\u002Fu\u002F25020235?v=4\",\"gravatar_id\":\"\",\"url\":\"https:\u002F\u002Fapi.github.com\u002Fusers\u002FAndersama\",\"html_url\":\"https:\u002F\u002Fgithub.com\u002FAndersama\",\"followers_url\":\"https:\u002F\u002Fapi.github.com\u002Fusers\u002FAndersama\u002Ffollowers\",\"following_url\":\"https:\u002F\u002Fapi.github.com\u002Fusers\u002FAndersama\u002Ffollowing{\u002Fother_user}\",\"gists_url\":\"https:\u002F\u002Fapi.github.com\u002Fusers\u002FAndersama\u002Fgists{\u002Fgist_id}\",\"starred_url\":\"https:\u002F\u002Fapi.github.com\u002Fusers\u002FAndersama\u002Fstarred{\u002Fowner}{\u002Frepo}\",\"subscriptions_url\":\"https:\u002F\u002Fapi.github.com\u002Fusers\u002FAndersama\u002Fsubscriptions\",\"organizations_url\":\"https:\u002F\u002Fapi.github.com\u002Fusers\u002FAndersama\u002Forgs\",\"repos_url\":\"https:\u002F\u002Fapi.github.com\u002Fusers\u002FAndersama\u002Frepos\",\"events_url\":\"https:\u002F\u002Fapi.github.com\u002Fusers\u002FAndersama\u002Fevents{\u002Fprivacy}\",\"received_events_url\":\"https:\u002F\u002Fapi.github.com\u002Fusers\u002FAndersama\u002Freceived_events\",\"type\":\"User\",\"site_admin\":false},\"html_url\":\"https:\u002F\u002Fgithub.com\u002FAndersama\u002Fctre_lexer_benchmark\",\"description\":null,\"fork\":false,\"url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\",\"forks_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fforks\",\"keys_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fkeys{\u002Fkey_id}\",\"collaborators_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fcollaborators{\u002Fcollaborator}\",\"teams_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fteams\",\"hooks_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fhooks\",\"issue_events_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fissues\u002Fevents{\u002Fnumber}\",\"events_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fevents\",\"assignees_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fassignees{\u002Fuser}\",\"branches_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fbranches{\u002Fbranch}\",\"tags_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Ftags\",\"blobs_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fgit\u002Fblobs{\u002Fsha}\",\"git_tags_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fgit\u002Ftags{\u002Fsha}\",\"git_refs_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fgit\u002Frefs{\u002Fsha}\",\"trees_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fgit\u002Ftrees{\u002Fsha}\",\"statuses_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fstatuses\u002F{sha}\",\"languages_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Flanguages\",\"stargazers_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fstargazers\",\"contributors_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fcontributors\",\"subscribers_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fsubscribers\",\"subscription_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fsubscription\",\"commits_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fcommits{\u002Fsha}\",\"git_commits_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fgit\u002Fcommits{\u002Fsha}\",\"comments_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fcomments{\u002Fnumber}\",\"issue_comment_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fissues\u002Fcomments{\u002Fnumber}\",\"contents_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fcontents\u002F{+path}\",\"compare_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fcompare\u002F{base}...{head}\",\"merges_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fmerges\",\"archive_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002F{archive_format}{\u002Fref}\",\"downloads_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fdownloads\",\"issues_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fissues{\u002Fnumber}\",\"pulls_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fpulls{\u002Fnumber}\",\"milestones_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fmilestones{\u002Fnumber}\",\"notifications_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fnotifications{?since,all,participating}\",\"labels_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Flabels{\u002Fname}\",\"releases_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Freleases{\u002Fid}\",\"deployments_url\":\"https:\u002F\u002Fapi.github.com\u002Frepos\u002FAndersama\u002Fctre_lexer_benchmark\u002Fdeployments\",\"created_at\":\"2020-11-19T06:25:02Z\",\"updated_at\":\"2020-12-22T20:36:27Z\",\"pushed_at\":\"2020-12-22T20:36:25Z\",\"git_url\":\"git:\u002F\u002Fgithub.com\u002FAndersama\u002Fctre_lexer_benchmark.git\",\"ssh_url\":\"git@github.com:Andersama\u002Fctre_lexer_benchmark.git\",\"clone_url\":\"https:\u002F\u002Fgithub.com\u002FAndersama\u002Fctre_lexer_benchmark.git\",\"svn_url\":\"https:\u002F\u002Fgithub.com\u002FAndersama\u002Fctre_lexer_benchmark\",\"homepage\":null,\"size\":35,\"stargazers_count\":0,\"watchers_count\":0,\"language\":\"C++\",\"has_issues\":true,\"has_projects\":true,\"has_downloads\":true,\"has_wiki\":true,\"has_pages\":false,\"forks_count\":0,\"mirror_url\":null,\"archived\":false,\"disabled\":false,\"open_issues_count\":0,\"license\":null,\"allow_forking\":true,\"forks\":0,\"open_issues\":0,\"watchers\":0,\"default_branch\":\"master\",\"content\":\"\u003Ch1\u003Ectre_lexer_benchmark\u003C\u002Fh1\u003E\\n\u003Cp\u003EA quick test of different lexing approaches. Unfortuantely while ctre is fantastic for generating native code that you'd have otherwise written by hand, it can be outdone with a dfa approach.\u003C\u002Fp\u003E\\n\u003Cp\u003ESome not so great testing results...where my naive attempts blow ctre out of the water.\u003C\u002Fp\u003E\\n\u003Cp\u003ENote: not exactly a complete test suite, here I'm comparing approaches to lex whitespace and non-whitespace characters. The dfa is extremely small.\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-apache\\\"\u003E| \u003Cspan class=\\\"hljs-attribute\\\"\u003Erelative\u003C\u002Fspan\u003E |             ns\u002Fbyte |              byte\u002Fs |    err% |     total | benchmark\\n|---------:|--------------------:|--------------------:|--------:|----------:|:----------\\n|   \u003Cspan class=\\\"hljs-attribute\\\"\u003E100\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E% |                \u003Cspan class=\\\"hljs-number\\\"\u003E2\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E12\u003C\u002Fspan\u003E |      \u003Cspan class=\\\"hljs-number\\\"\u003E472\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E049\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E817\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E08\u003C\u002Fspan\u003E |    \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E7\u003C\u002Fspan\u003E% |      \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E32\u003C\u002Fspan\u003E | `hand_coded table`\\n|   \u003Cspan class=\\\"hljs-attribute\\\"\u003E214\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E2\u003C\u002Fspan\u003E% |                \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E99\u003C\u002Fspan\u003E |    \u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E011\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E189\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E413\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E06\u003C\u002Fspan\u003E |    \u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E6\u003C\u002Fspan\u003E% |      \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E35\u003C\u002Fspan\u003E | `hand_coded table sse`\\n|    \u003Cspan class=\\\"hljs-attribute\\\"\u003E97\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E% |                \u003Cspan class=\\\"hljs-number\\\"\u003E2\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E18\u003C\u002Fspan\u003E |      \u003Cspan class=\\\"hljs-number\\\"\u003E458\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E505\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E050\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E23\u003C\u002Fspan\u003E |    \u003Cspan class=\\\"hljs-number\\\"\u003E2\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E7\u003C\u002Fspan\u003E% |      \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E32\u003C\u002Fspan\u003E | `hand_coded switch inside if`\\n|    \u003Cspan class=\\\"hljs-attribute\\\"\u003E94\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E9\u003C\u002Fspan\u003E% |                \u003Cspan class=\\\"hljs-number\\\"\u003E2\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E23\u003C\u002Fspan\u003E |      \u003Cspan class=\\\"hljs-number\\\"\u003E447\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E839\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E585\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E40\u003C\u002Fspan\u003E |    \u003Cspan class=\\\"hljs-number\\\"\u003E3\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E9\u003C\u002Fspan\u003E% |      \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E33\u003C\u002Fspan\u003E | `hand_coded switch only in loop`\\n|    \u003Cspan class=\\\"hljs-attribute\\\"\u003E60\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E6\u003C\u002Fspan\u003E% |                \u003Cspan class=\\\"hljs-number\\\"\u003E3\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E50\u003C\u002Fspan\u003E |      \u003Cspan class=\\\"hljs-number\\\"\u003E285\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E960\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E135\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E45\u003C\u002Fspan\u003E |    \u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E4\u003C\u002Fspan\u003E% |      \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E35\u003C\u002Fspan\u003E | `hand_coded break to switch`\\n|    \u003Cspan class=\\\"hljs-attribute\\\"\u003E11\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E8\u003C\u002Fspan\u003E% |               \u003Cspan class=\\\"hljs-number\\\"\u003E17\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E97\u003C\u002Fspan\u003E |       \u003Cspan class=\\\"hljs-number\\\"\u003E55\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E642\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E484\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E11\u003C\u002Fspan\u003E |    \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E7\u003C\u002Fspan\u003E% |      \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E66\u003C\u002Fspan\u003E | `ctre::starts_with`\\n|     \u003Cspan class=\\\"hljs-attribute\\\"\u003E8\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E% |               \u003Cspan class=\\\"hljs-number\\\"\u003E26\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E04\u003C\u002Fspan\u003E |       \u003Cspan class=\\\"hljs-number\\\"\u003E38\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E396\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E531\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E90\u003C\u002Fspan\u003E |    \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E% |      \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-number\\\"\u003E92\u003C\u002Fspan\u003E | `ctre::starts_with overlap_strs`\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EI absolutely hate and detest having to write tables by hand. So I'm very motivated to improve on ctre. Since regexs can be represented as dfa's I don't see any particular reason why there shouldn't be an equivalent ctdfa library. In fact in having played around with the internals of the ctre library a few times it seems extremely tempting to rip the existing compile time parser for the purpose of building dfas.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn testing I've already found a significant improvement in searching for a string based pattern by transforming some strings info a prefix dfa matcher. A lot of the current results are mostly an unfortunate consequence of branch misprediction, otherwise the native code representing the regex should be a clear win. Another option would be to perhaps make a \\\"helper\\\" ctre function to generate something more akin to an optimal lexer, much like \\\"starts_with\\\". Don't want to bother Hana though.\u003C\u002Fp\u003E\\n\u003Cp\u003EI've picked up a few new tricks from \u003Ca href=\\\"https:\u002F\u002Fbranchfree.org\u002F\\\"\u003Ehttps:\u002F\u002Fbranchfree.org\u002F\u003C\u002Fa\u003E, quite frankly my original lexers were quite a mess of a combination of the two approaches, and I'd have been happy to have results akin to \u003Ccode\u003Ectre:::starts_with\u003C\u002Fcode\u003E here. However that lexer does significantly more work for an even more complicated regular expression, it keeps track of rows and columns, de-escapes strings and adds them to a hash table database and peforms both string to integer and string to floating point operations. It's difficult to gauge how good my lexer is without peformance benchmarks of other lexers built to tackle the same problem space. The ones I've found like for the RE2 library and even for tinyC lead me to think I'm close, but at the same time given the results touted by simdjson, simdcsv and hyperscan lead me to think otherwise.\u003C\u002Fp\u003E\\n\u003Cp\u003EAnother consideration is I've not dealt with or touched anything to do w\u002F utf8. There's an obvious cost to the dfa table size if the dfa is meant to handle utf8 sequences. It's not entirely obvious to me whether processing input in utf8 form is worth it, the variable size would seem to mean that there'd need to be two loops, which would add another branch predicition issue into the mix.\u003C\u002Fp\u003E\\n\u003Cp\u003EIdeally I'd have a library that:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003ECan represent a language as a series of regexs at compile time\u003C\u002Fli\u003E\\n\u003Cli\u003ECan generate some near optimal code for a lexer\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003EI can live with post processing tokens, I'd much rather have a blazing fast lexer \u002F parser in my tool belt.\u003C\u002Fp\u003E\\n\u003Cp\u003ENote to self: Just spotted dfa branch in the ctre library* will be taking a look at that.\u003C\u002Fp\u003E\"}"}</script>
		</div>
		<!--Traffic-->
		<script async defer
		 data-website-id="64a6ac0c-d6ba-4020-8e6a-598695803b90" 
		 src="https://andersama-umami.vercel.app/umami.js"
		 data-do-not-track="true"
		 data-domains="andersama.github.io"></script>
	</body>
</html>
